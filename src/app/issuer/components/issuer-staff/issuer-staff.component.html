<div *bgAwaitPromises="[issuerLoaded, profileEmailsLoaded]">
	<form-message></form-message>
	<header class="wrap wrap-light l-containerhorizontal l-heading">
		<nav>
			<h1 class="visuallyhidden">Breadcrumbs</h1>
			<ul class="breadcrumb">
				<li><a [routerLink]="['/issuer']">Issuers</a></li>
				<li *ngIf="issuer"><a [routerLink]="['/issuer/issuers', issuerSlug]">{{ issuer.name }}</a></li>
				<li class="breadcrumb-x-current">
				</li>
			</ul>
		</nav>

		<div class="heading">
			<div class="heading-x-image">
				<img *ngIf="issuer.image" [src]="issuer.image" alt="{{issuer.name}} logo " />
				<img *ngIf="!issuer.image" [src]="issuerImagePlaceHolderUrl" alt="Default issuer image">
			</div>
			<div class="heading-x-text">
				<h1>{{ isCurrentUserIssuerOwner ? "Manage Staff" : "View Staff" }}</h1>
				<p>
					{{
					isCurrentUserIssuerOwner
						? "Manage who has access to manage and act on behalf of this issuer."
						: "View who has access to manage and act on behalf of this issuer."
					}}
				</p>
			</div>
		</div>

	</header>

	<div class="l-containerhorizontal l-containervertical l-childrenvertical wrap">
		<form [formGroup]="staffCreateForm"
				(ngSubmit)="submitStaffCreate(staffCreateForm.value)">
			<table class="table table-staffeditor">
				<thead>
					<tr>
						<th>Name</th>
						<th class="hidden hidden-is-tablet">Email</th>
						<th class="table-staffeditor-x-role">Role</th>
						<th class="hidden hidden-is-tablet" *ngIf="isCurrentUserIssuerOwner"><span class="visuallyhidden">Actions</span>
						</th>
					</tr>
				</thead>

				<!-- Add Member Row -->
				<tbody class="table-x-tbody hidden hidden-is-tablet" *ngIf="isCurrentUserIssuerOwner">
					<tr class="table-x-active">
						<th>
							<em>
								New Staff Member
							</em>
						</th>

						<td>
							<bg-formfield-text [control]="staffCreateForm.controls.staffEmail"
												[errorMessage]="'Please enter valid email address'"
												placeholder="Staff Email"
							></bg-formfield-text>
						</td>

						<td class="table-staffeditor-x-role">
							<bg-formfield-select [control]="staffCreateForm.controls.staffRole"
													[options]="issuerStaffRoleOptions"
													[errorMessage]="'Please select a staff role'"
							></bg-formfield-select>
						</td>

						<td class="hidden hidden-is-tablet">
							<button class="button button-primaryghost"
									type="submit"
									[disabled-when-requesting]="true"
							>Add Member
							</button>
						</td>
					</tr>
				</tbody>

				<tbody>
					<tr *ngFor="let member of issuer.staff">
						<td>
							{{ member.nameLabel }}
						</td>
						<td class="hidden hidden-is-tablet">
							{{ member.email }}
						</td>
						<td class="l-childrenhorizontal formfield table-staffeditor-x-role">
							<select [value]="member.roleSlug"
									[disabled]="member == issuer.currentUserStaffMember"
									(change)="changeMemberRole(member, $event.target.value)"
									*ngIf="isCurrentUserIssuerOwner"
							>
								<option *ngFor="let role of issuerStaffRoleOptions" [value]="role.value">{{ role.label }}</option>
							</select>
							<span *ngIf="! isCurrentUserIssuerOwner">
								{{ member.roleInfo.label }}
							</span>
						</td>
						<td *ngIf="isCurrentUserIssuerOwner" class="hidden hidden-is-tablet">
							<button class="button button-primaryghost"
									type="button"
									[disabled-when-requesting]="true"
									(click)="removeMember(member)"
									*ngIf="member != issuer.currentUserStaffMember"
							>Remove Member
							</button>
						</td>
					</tr>
				</tbody>
			</table>
		</form>
	</div>
</div>
