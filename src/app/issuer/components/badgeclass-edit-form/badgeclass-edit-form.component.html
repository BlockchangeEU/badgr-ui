<form-message></form-message>
<form class="l-containerhorizontal l-containervertical"
			[formGroup]="badgeClassForm"
			(ngSubmit)="onSubmit(badgeClassForm.value)"
			novalidate
>
	<!-- General Details Panel -->
	<div class="l-formsection wrap wrap-well" role="group" aria-labelledby="heading-basicinformation">
		<h3 class="l-formsection-x-legend title title-ruled" id="heading-basicinformation">Basic Information</h3>
		<div class="l-formsection-x-container">
			<div class="l-formsection-x-help">
				<h4 class="title title-bordered" id="heading-badgebasics">Badge Basics</h4>
				<p class="text text-small">Badge images can be either PNGs or SVGs. <strong>All fields are required.</strong></p>
				<a class="button button-tertiaryghost"
					 href="https://support.badgr.io/pages/viewpage.action?pageId=327763"
					 aria-labelledby="heading-badgebasics"
					 target="_blank"
				>Learn More</a>
			</div>
			<div class="l-formsection-x-inputs">
				<div class="l-formimageupload">
					<bg-formfield-image
						#imageField
						label="Image"
						imageLoaderName="badge"
						[newDropZone]="true"
						class="l-formimageupload-x-upload"
						[placeholderImage]="badgeClassPlaceholderImageUrl"
						[control]="badgeClassForm.controls.badge_image"
					>
								<span label-additions>
									<span>(<button type="button" (click)="generateRandomImage()">generate random<span class="visuallyhidden"> badge image</span></button>)</span>
								</span>
					</bg-formfield-image>

					<div class="l-formimageupload-x-inputs">
						<badge-studio #badgeStudio [hidden]="true"></badge-studio>

						<bg-formfield-text
							[control]="badgeClassForm.controls.badge_name"
							label="Name"
							[errorMessage]="{ required: 'Please enter a badge name' }"
							[autofocus]="true"
						></bg-formfield-text>

						<bg-formfield-text
							[control]="badgeClassForm.controls.badge_description"
							label="Short Description"
							id="badgeclass_description_input"
							placeholder="A short summary of this achievement."
							[errorMessage]="{ required: 'Please enter a description' }"
							[multiline]="true"
						></bg-formfield-text>
					</div>
				</div>
			</div>
		</div>
	</div>

	<!-- Criteria Panel -->
	<div class="l-formsection wrap wrap-well" role="group" aria-labelledby="heading-criteria">
		<h3 class="l-formsection-x-legend title title-ruled" id="heading-criteria">Criteria</h3>
		<div class="l-formsection-x-container">
			<div class="l-formsection-x-help">
				<h4 class="title title-bordered" id="heading-whatscriteria">What are Criteria?</h4>
				<p class="text text-small">
					The criteria field describes exactly what must be done to earn this badge. Some issuers choose a URL on
					their website as a promotional page that explains this badge opportunity and how to earn it.
					<strong>At least one field is required.</strong>
				</p>
				<a class="button button-tertiaryghost"
					 href="https://support.badgr.io/pages/viewpage.action?pageId=327768"
					 aria-labelledby="heading-whatscriteria"
					 target="_blank"
				>Learn More</a>
			</div>
			<div class="l-formsection-x-inputs">
				<p
					[hidden]="!alignmentFieldDirty || !badgeClassForm.hasError('criteriaRequired')"
					class="text text-is-error">Either text or URL is required.</p>

				<bg-formfield-markdown
					[control]="badgeClassForm.controls.badge_criteria_text"
					label="How is this Badge Earned?"
					class="l-formsection-x-inputoffset"
					[errorMessage]="''"
				></bg-formfield-markdown>

				<bg-formfield-text
					[control]="badgeClassForm.controls.badge_criteria_url"
					label="URL"
					[urlField]="true"
					fieldType="url"
					errorMessage="URL to the Badge Criteria Page"
				></bg-formfield-text>
			</div>
		</div>
	</div>

	<!-- Alignments Panel -->
	<div class="l-formsection wrap wrap-well"
			 role="group"
			 aria-labelledby="heading-alignment"
			 *ngIf="alignmentsEnabled"
	>
		<h3 class="l-formsection-x-legend title title-ruled"
				id="heading-alignment"
		>
			Alignment <span>(optional)</span>
		</h3>
		<div class="l-formsection-x-container">
			<div class="l-formsection-x-help">
				<h4 class="title title-bordered" id="heading-whatsalignment">What's Alignment?</h4>
				<p class="text text-small">
					An Open Badge can optionally align to an educational standard. Alignment
					information may be relevant to people viewing an earner's awarded badges, or to a potential earner
					deciding whether to apply for the badge.
				</p>
				<a class="button button-tertiaryghost"
					 href="https://support.badgr.io/pages/viewpage.action?pageId=327768"
					 aria-labelledby="heading-whatsalignment"
					 target="_blank"
				>Learn More</a>
			</div>
			<div class="l-formsection-x-inputs">
				<div class="l-formsectionnested wrap wrap-welldark" *ngFor="let alignment of alignments.controls; let i = index">
					<h5 class="visuallyhidden" id="heading-alignmentsubsection">{{ alignment.controls.target_name.value }}</h5>

					<bg-formfield-text
						[control]="alignment.controls.target_name"
						label="Name"
						[errorMessage]="{required:'Please enter an alignment name'}"
						id="alignment_name_{{ i }}"
					></bg-formfield-text>

					<bg-formfield-text
						[control]="alignment.controls.target_url"
						label="URL"
						[errorMessage]="{required:'Please enter an alignment URL'}"
						[urlField]="true"
						id="alignment_url_{{ i }}"
					></bg-formfield-text>

					<bg-formfield-text
						[control]="alignment.controls.target_description"
						label="Short Description"
						[multiline]="true"
						id="alignment_description_{{ i }}"
					></bg-formfield-text>

					<div class="l-formsectiontoggle">
						<input class="l-formsectiontoggle-x-toggle formsectiontoggle visuallyhidden"
									 type="checkbox"
									 id="alignmentAdvancedToggle_{{ i }}"
									 name="alignmentAdvancedToggle_{{ i }}"
						/>
						<label for="alignmentAdvancedToggle_{{ i }}">
							<span class="formsectiontoggle-x-showtext">Show</span>
							<span class="formsectiontoggle-x-hidetext">Hide</span>
							Advanced Options
						</label>

						<div class="l-formsectiontoggle-x-hidden">
							<bg-formfield-text
								[control]="alignment.controls.target_framework"
								label="Framework"
								id="alignment_target_framework_{{ i }}"
							></bg-formfield-text>
							<bg-formfield-text
								[control]="alignment.controls.target_code"
								label="Code"
								id="alignment_target_code_{{ i }}"
							></bg-formfield-text>
						</div>
					</div>
					<button class="l-formsectionnested-x-remove formsectionremove"
									aria-labelledby="heading-alignmentsubsection"
									(click)="removeAlignment(alignment)"
									*ngIf="alignments.length > 1"
									type="button"
					>Remove</button>
				</div>
				<button class="buttonicon buttonicon-add" type="button" (click)="addAlignment()">Add Another</button>
			</div>
		</div>
		<button class="l-formsection-x-remove formsectionremove"
						aria-labelledby="heading-alignment"
						(click)="disableAlignments()"
						type="button"
		>Remove</button>
	</div>

	<!-- Tags Panel -->
	<div class="l-formsection wrap wrap-well" role="group" aria-labelledby="heading-tags" *ngIf="tagsEnabled">
		<h3 class="l-formsection-x-legend title title-ruled" id="heading-tags">Tags</h3>
		<div class="l-formsection-x-container">
			<div class="l-formsection-x-help">
				<h4 class="title title-bordered" id="heading-whataretags">What are Tags?</h4>
				<p class="text text-small">
					Tags are optional ways to describe a type of achievement. When you use tags, you help people who are
					interested in your topic find your Badge.
				</p>
				<a class="button button-tertiaryghost"
					 href="https://support.badgr.io/pages/viewpage.action?pageId=327768"
					 aria-labelledby="heading-whataretags"
					 target="_blank"
				>Learn More</a>
			</div>
			<div class="l-formsection-x-inputs">
				<ul class="l-tags">
					<li *ngFor="let tag of tags">
						<div class="tag">
							<span class="tag-x-text">{{ tag }}</span>
							<button type="button" (click)="removeTag(tag)">Remove {{ tag }} tag</button>
						</div>
					</li>
				</ul>
				<div class="l-formsection-x-maxwidthinput formfield">
					<label for="formfield">Add a Tag</label>
					<div class="formaddinput">
						<label class="visuallyhidden" for="addtag" id="formaddinput-addtag">Tag</label>
						<input type="text" name="addtag" id="addtag" (keypress)="handleTagInputKeyPress($event)" #newTagInput>
						<button aria-labelledby="formaddinput-addtag"
										type="button"
										(click)="addTag()"
						>Add</button>
					</div>
				</div>
			</div>
		</div>
		<button class="l-formsection-x-remove formsectionremove"
						aria-labelledby="heading-tags"
						type="button"
						(click)="disableTags()"
		>Remove</button>
	</div>

	<!-- Expiration Panel -->
	<div class="l-formsection wrap wrap-well" role="group" aria-labelledby="heading-tags" *ngIf="expirationEnabled">
		<h3 class="l-formsection-x-legend title title-ruled" id="heading-tags">Expiration</h3>
		<div class="l-formsection-x-container">
			<div class="l-formsection-x-help">
				<h4 class="title title-bordered" id="heading-whataretags">Badge Expiration?</h4>
				<p class="text text-small">
					Add the duration this badge is generally valid for. This can also be changed at the time of award. Badges will be marked as expired after expiration.
				</p>
				<a class="button button-tertiaryghost"
					 href="https://support.badgr.io/pages/viewpage.action?pageId=327768"
					 aria-labelledby="heading-whataretags"
					 target="_blank"
				>Learn More</a>
			</div>
			<div class="l-formsection-x-inputs">

				<div class="formfield">
					<fieldset>
						<legend class="u-margin-bottom2x text text-quiet">How long is this award valid?</legend>
						<div class="l-formtwoup">
							<bg-formfield-text [control]="expirationForm.controls.expires_amount"
																 label="Number"
							></bg-formfield-text>
							<bg-formfield-select ariaLabel="Select Duration"
																	 [control]="expirationForm.controls.expires_duration"
																	 label="Duration"
																	 [placeholder]="'Select a duration'"
																	 [optionMap]="durationOptions"
							></bg-formfield-select>
						</div>
					</fieldset>
				</div>
			</div>
		</div>
		<button class="l-formsection-x-remove formsectionremove"
						aria-labelledby="heading-tags"
						type="button"
						(click)="disableExpiration()"
		>Remove</button>
	</div>

	<!-- Footer -->
	<div class="l-formsection l-formsection-span wrap wrap-well" role="group" aria-labelledby="heading-addoptionaldetails">
		<!-- Optional Detail Enable Panel -->
		<h3 class="l-formsection-x-legend title title-ruled title-ruledadd" id="heading-addoptionaldetails">Add Optional Details</h3>
		<div class="l-formsection-x-container">
			<div class="l-formsection-x-inputs">
				<div class="l-squareiconcards">
					<button class="squareiconcard squareiconcard-alignment"
									type="button"
									(click)="enableAlignments()"
									[disabled]="alignmentsEnabled"
					>
						<span class="squareiconcard-x-container">Alignment</span>
					</button>
					<button class="squareiconcard squareiconcard-tags"
									type="button"
									(click)="enableTags()"
									[disabled]="tagsEnabled"
					>
						<span class="squareiconcard-x-container">Tags</span>
					</button>
					<button class="squareiconcard squareiconcard-expiration"
									type="button"
									(click)="enableExpiration()"
									[disabled]="expirationEnabled"
					>
						<span class="squareiconcard-x-container">Expiration</span>
					</button>
				</div>
			</div>
		</div>

	</div>
	<hr class="rule l-rule">
	<div class="l-childrenhorizontal l-childrenhorizontal-right">
		<button
			class="button button-primaryghost"
			type="button"
			[disabled-when-requesting]="true"
			(click)="cancelClicked()"
		>Cancel</button>
		<button
			type="submit"
			class="button"
			[disabled]="!! savePromise"
			[loading-promises]="[ savePromise ]"
			loading-message="{{ submittingText }}"
			(click)="submitClicked($event)"
		>{{ submitText }}</button>
	</div>
</form>
